<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<title>Hive Login</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="functions.js"></script>
<script>

function login() {
	username = document.getElementById("username").value;
	password = document.getElementById("password").value;
	headers = {"Content-Type": "application/json", "Accept": "application/json"}
	payload = {"username": username, "password": password}
	$.ajax({
		url: baseurl + '/global/login',
		type: 'POST',
		headers: headers,
		data: JSON.stringify(payload),
		dataType: 'json',
		success: function(json) {
			console.log(json);
			if ('token' in json) {
				console.log('success');
				setCookie('token', json['token'], 365)
				document.getElementById("loginstate").innerHTML = 'You are now logged in.';
				document.getElementById("mainbody").innerHTML = "<a href='schedule.html'>Schedule view</a><br /><a href='history.html'>History view</a><br />";
			}
		},
		error: function(json) {
			console.log('Error');
			console.log(json);
		}
	})
}

window.onload = function() {
	headlatlong = checklogin();
	var headers = headlatlong[0];
	if (headers != null) {
		document.getElementById("loginstate").innerHTML = "You are now logged in.";
		document.getElementById("mainbody").innerHTML = "<a href='schedule.html'>Schedule view</a><br /><a href='history.html'>History view</a><br />"
	};
}

</script>
<style>
.l1 {
	width: 100px;
	display: inline-block;
}
</style>
</head>
<body>

<div id="loginstate">You are not logged in.</div><br /><br />
<div id="mainbody"><label class="l1" for="username">Username: </label><input id="username"><br />
<label class="l1" for="password">Password: </label><input type="password" id="password"><br /><br />
<input type="submit" value="Submit" onclick="return login();"></div>
</body></html>
